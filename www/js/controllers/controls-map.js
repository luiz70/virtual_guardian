angular.module('starter.controllers')
.controller('controls',function($scope,$rootScope,Mapa,uiGmapIsReady,$timeout,Ubicacion,Message){
	$scope.map=$rootScope.map;
	$scope.ubicacion=$rootScope.ubicacion;
	$scope.radio=$rootScope.radio;
	$rootScope.controls=[
		{nombre:"buscar",
			id:1,
			activo:false,
			activable:false,
			content:"",
			onClick:function(){
				$rootScope.search=true;
			},
		},
		{nombre:"ubicacion",
			id:2,
			activo:false,
			activable:true,
			content:"",
			onClick:function(){
				$scope.refreshLocation();
			},
		},
		{nombre:"auto",
			id:3,
			activo:false,//$rootScope.map.auto.activo,
			activable:true,
			posicionando:false,
			content:"",
			onClick:function(){
			$scope.carPark();
			},
		},
		{nombre:"filtro",
			id:4,
			activo:false,
			activable:true,
			content:"",
			onClick:function(){
			Message.showModal("templates/modal/filtros.html");
			},
		},
		{nombre:"periodo",
			id:5,
			activo:false,
			activable:false,
			content:"<div class='letra-periodo'>{{$rootScope.Usuario.Periodo}}</div>",
			onClick:function(){
				var buttons=[]
				if($rootScope.Usuario.Periodo!=7)buttons.push({text:$rootScope.idioma.Periodos[7],valor:7})
				if($rootScope.Usuario.Periodo!=30)buttons.push({text:$rootScope.idioma.Periodos[30],valor:30})
				if($rootScope.Usuario.Periodo!=180)buttons.push({text:$rootScope.idioma.Periodos[180],valor:180})
				if($rootScope.Usuario.Periodo!=365)buttons.push({text:$rootScope.idioma.Periodos[365],valor:365})
				
				Message.showActionSheet($rootScope.idioma.Mapa[5],buttons,null,$rootScope.idioma.General[6],function(res,data){
					if(data)$rootScope.Usuario.Periodo=data.valor;
				})
			},
		},
	]
	$scope.controls=$rootScope.controls;
	$scope.controlClick=function(i){
		//if($scope.controls[i].activable)$scope.controls[i].activo=!$scope.controls[i].activo
		$rootScope.controls[i].onClick()
		
	}
	uiGmapIsReady.promise()
	.then(function(maps){
		$scope.mapa=$rootScope.map;
        $(".gm-style div").first().click($scope.hideControls)
        $(".gm-style div").first().mousedown($scope.hideControls)
		$scope.showControls();
	})
	$scope.showControls=function(){
		$(".contenedor-mapa-top-right").animate({
			right:"1vh"
		},200);
		$(".boton-mapa-top-right.options").animate({
		opacity:0
		},200,function(){
		});
	}
	$scope.hideControls=function(){
		$(".contenedor-mapa-top-right").animate({
			right:"-10vh"
		},400);
		$(".boton-mapa-top-right.options").animate({
		opacity:1
		},200);
	}
	$scope.refreshLocation=function(){
		$rootScope.eventosMap=[];
		Ubicacion.refreshLocation();
		
	}
	$scope.carPark=function(){
		$rootScope.map.auto.posicionando=true;
		
	}
	$scope.setAuto=function(){
		$rootScope.map.auto.posicionando=false;
		$rootScope.map.auto.activo=true;
	}
	
})
.controller('top-center',function($scope,$rootScope,Mapa,uiGmapIsReady,$timeout){
	$scope.idioma=$rootScope.idioma;
	$scope.map=$rootScope.map;
})
